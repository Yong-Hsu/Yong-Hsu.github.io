<html lang="en">
<title>Worksheet 1 - Part 1</title>
<script src="../angel_common/initShaders.js"></script>
<script src="../angel_common/webgl-utils.js"></script>
<script src="../angel_common/MV.js"></script>
<script src="week4/t45.js"></script>

<script id="vertex-shader" type="x-shader/x-vertex">
	precision mediump float;
	attribute vec4 vPosition;
	attribute vec4 vNormal;

    varying vec4 vPos;
	varying vec4 vNorm;

	uniform mat4 modelMatrix;
	uniform mat4 viewMatrix;
	uniform mat4 projectionMatrix;
	
	void main()
	{
		vPos = vPosition;
		vNorm = vNormal;

		gl_Position = projectionMatrix * viewMatrix * modelMatrix * vPosition;
	}
</script>

<script id="fragment-shader" type="x-shader/x-fragment">
	precision mediump float;

	varying vec4 vPos;
	varying vec4 vNorm;

	uniform mat4 modelMatrix;
	uniform mat4 viewMatrix;
	uniform mat4 projectionMatrix;
	
	uniform mat4 normalsArray;
	uniform vec4 lightPos;
	uniform vec3 emission_le; // intensity
	uniform vec3 diffuse_kd;
	uniform	vec3 ambient_ka;
	uniform	vec3 specular_ks;
	uniform	float shininess;

	void main()
	{
		vec4 position = viewMatrix * modelMatrix * vPos;
		vec3 normal = normalize(mat3(viewMatrix) * normalize(vNorm.xyz));
		vec4 lightPoss = viewMatrix * lightPos;

		vec3 w_i = lightPoss.w == 0.0 ? normalize(-lightPoss.xyz) : normalize(lightPoss.xyz - position.xyz); 
		
		vec3 l_i = 1.0 * emission_le * pow(length(w_i), 2.0);
		vec3 l_d = diffuse_kd * l_i * max(dot(normal, w_i), 0.0);

		vec3 w_h = normalize(w_i - normalize(position.xyz));
		vec3 ls_bp = specular_ks * l_i * pow(max(dot(normal, w_h), 0.0), shininess);

		position = projectionMatrix * position;
		
		vec4 fColor = vec4(l_d + ls_bp + ambient_ka * emission_le, 1.0);
		
		// how does the fragment shader do this
		gl_FragColor = fColor;
	}
</script>

<!-- <body onpageshow="start_code_behind()"> -->

<body>
	<!-- close the canvas tag, make sure button is not included in this element -->
	<table>
	<tr>
		<th>
			<canvas id='gl-canvas' height="512" width="512">
				"WebGL isn't available"
			</canvas>
		</th>
		<th style="width: 512px;">
			<div id="biasindex">
				<div class="slidercaption"> Radiance (L_e):                    0.0 </div>
				<div class="slidercontainer" style="display:inline">
					<input type="range" min="1" max="20" value="20" class="slider" id="radianceSlider">
				</div>
				<div class="slidercaption">  2.4 </div>
			</div>
			<br>
			<div id="biasindex">
				<div class="slidercaption"> Ambient coefficient (k_a):   0.0 </div>
				<div class="slidercontainer" style="display:inline">
					<input type="range" min="1" max="20" value="20" class="slider" id="ambientSlider">
				</div>
				<div class="slidercaption">  1.0 </div>
			</div>
			<br>
			<div id="biasindex">
				<div class="slidercaption"> Diffuse coefficient (k_d):     0.0 </div>
				<div class="slidercontainer" style="display:inline">
					<input type="range" min="1" max="20" value="9" class="slider" id="diffuseSlider">
				</div>
				<div class="slidercaption">  1.0 </div>
			</div>
			<br>
			<div id="biasindex">
				<div class="slidercaption"> Specular coefficient (k_s):   0.0 </div>
				<div class="slidercontainer" style="display:inline">
					<input type="range" min="1" max="20" value="12" class="slider" id="specularSlider">
				</div>
				<div class="slidercaption">  1.0 </div>
			</div>
			<br>
			<div id="biasindex">
				<div class="slidercaption"> Shininess (s):                         0.0 </div>
				<div class="slidercontainer" style="display:inline">
					<input type="range" min="1" max="20" value="1" class="slider" id="shininessSlider">
				</div>
				<div class="slidercaption">  1e3 </div>
			</div>
		</th>
	</tr>
	<tbody>
		<tr>
			<td>
				<button type="button" id="increase" style="width: 25%;"> Coarsen ➖ </button>
				<button type="button" id="decrease" style="width: 25%;"> Subdivide ➕ </button>
				<button type="button" id="orbit" style="width: 35%;"> Toggle orbiting ⏯ </button>
			</td>
			<td></td>
		</tr>
	</tbody>
	</table>



	<br>


	<br>
</body>

<style>
	/* todo: move it outside */
	#biasindex {
		display: flex;
	}

	.slidercontainer {
		width: 196%;
	}

	.slidercaption {
		display: inline-block;
		white-space: nowrap;
		white-space:pre;
	}

	.slider {
		-webkit-appearance: none;
		width: 100%;
		height: 15px;
		border-radius: 5px;
		background: #d3d3d3;
		outline: none;
		opacity: 0.7;
		-webkit-transition: .2s;
		transition: opacity .2s;
	}

	.slider::-webkit-slider-thumb {
		-webkit-appearance: none;
		appearance: none;
		width: 25px;
		height: 25px;
		border-radius: 50%;
		background: #04AA6D;
		cursor: pointer;
	}

	.slider::-moz-range-thumb {
		width: 25px;
		height: 25px;
		border-radius: 50%;
		background: #04AA6D;
		cursor: pointer;
	}
</style>

</html>
<!-- https://webglfundamentals.org/webgl/lessons/webgl-how-it-works.html -->