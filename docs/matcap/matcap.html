<html lang="en">
<script src="../angel_common/initShaders.js"></script>
<script src="../angel_common/webgl-utils.js"></script>
<script src="../angel_common/MV.js"></script>
<script type="text/javascript" src="../angel_common/OBJParser.js"> </script>
<script src="matcap/matcap.js"></script>
<script src="matcap/quaternion.js"></script>

<script id="vertex-shader" type="x-shader/x-vertex">
	precision highp float;
	attribute vec3 a_Position;
	attribute vec3 a_Normal;
	attribute vec4 a_Color;

	varying vec4 fColor;
	varying vec4 vPos;
	varying vec3 vNorm;

	uniform mat4 modelMatrix;
	uniform mat4 viewMatrix;
	uniform mat4 projectionMatrix;

	void main()
	{
		vPos = vec4(a_Position, 1.0);
		vNorm = normalize(vec3(modelMatrix * vec4(a_Normal, 0.0))); 
		fColor = a_Color;

		gl_Position = projectionMatrix * viewMatrix * modelMatrix * vPos;
	}
</script>

<script id="fragment-shader" type="x-shader/x-fragment">
	precision highp float;

	varying vec4 fColor;
	varying vec4 vPos;
	varying vec3 vNorm;

	uniform mat4 modelMatrix;
	uniform mat4 viewMatrix;
	uniform mat4 projectionMatrix;

	uniform sampler2D matcapTexture; 

	void main()
	{
		// Move normal to view space
		highp vec2 muv = vec2(viewMatrix * vec4(normalize(vNorm), 0)) * 0.5 + vec2(0.5, 0.5);
		// read texture inverting Y value
		gl_FragColor = texture2D(matcapTexture, vec2(muv.x, 1.0 - muv.y));
	}
</script>

<!-- how to use the texture -->
<!-- understand how every step exactly happens -->

<body oncontextmenu="return false;">
	<canvas id='gl-canvas' height="512" width="512">
        "WebGL isn't available"
    </canvas>
</body>

</html>
